{% extends "blog/base.html" %}
{% block content %}

<div class="row">
    <!-- Left: Profile info -->
    <div class="col-md-8">
        <div class="content-section position-relative" style="padding: 20px;">
            <div class="media position-relative">
                <!-- Profile picture -->
                <div style="position: relative; display: inline-block;">
                    {% if user.profile.image %}
                        <img class="rounded-circle account-img" src="{{ user.profile.image.url }}" width="125" height="125" alt="Profile Picture">
                    {% else %}
                        <img class="rounded-circle account-img" src="/media/default.jpg" width="125" height="125" alt="Profile Picture">
                    {% endif %}

                    <!-- Edit button -->
                    <button id="change-image-btn" style="
                        position: absolute;
                        bottom: 0;
                        right: 0;
                        border: none;
                        background-color: #007bff;
                        color: white;
                        border-radius: 50%;
                        width: 35px;
                        height: 35px;
                        cursor: pointer;
                    " title="Change profile picture">
                        âœŽ
                    </button>
                </div>

                <!-- User info -->
                <div class="media-body ml-3">
                    <h2 class="account-heading">{{ user.username }}</h2>
                    <p class="text-secondary">{{ user.email }}</p>
                    <p class="text-muted">{{ user.profile.bio|default:"This user has no bio yet." }}</p>
                </div>
            </div>

            <!-- Hidden form to upload profile picture -->
            <form id="profile-upload-form" method="POST" enctype="multipart/form-data" style="display:none;">
                {% csrf_token %}
                <input type="file" name="image" id="profile-image-input" accept="image/*">
                <button type="submit" id="submit-btn"></button>
            </form>

        </div>
    </div>

    <!-- Right sidebar is handled in base.html -->
    <div class="col-md-4"></div>
</div>

<script>
    const changeBtn = document.getElementById('change-image-btn');
    const fileInput = document.getElementById('profile-image-input');
    const submitBtn = document.getElementById('submit-btn');

    // When the edit button is clicked, open file picker
    changeBtn.addEventListener('click', () => {
        fileInput.click();
    });

    // When a file is selected, automatically submit the form
    fileInput.addEventListener('change', () => {
        if(fileInput.files.length > 0){
            submitBtn.click();
        }
    });
</script>

<style>
.account-img {
    object-fit: cover;
}

.ml-3 {
    margin-left: 15px;
}

.account-heading {
    margin-bottom: 0;
}

.text-muted {
    color: #6c757d;
}

.media {
    display: flex;
    align-items: flex-start;
}
</style>

{% endblock content %}
